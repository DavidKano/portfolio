---
import Base from "../layouts/BaseLayout.astro";
import NavBar from "../components/NavBar.astro";
import SiteFooter from "../components/SiteFooter.astro";

const CV_URL = "/cv.pdf";
---
<Base title="David Cano ‚Äî CV">
  <NavBar />

  <main class="bg-white">
    <!-- Header -->
    <section class="mx-auto max-w-6xl px-6 pt-10 pb-6 text-center">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Curr√≠culum</h1>
      <p class="mt-2 text-zinc-600">Visualiza, descarga o imprime mi CV en PDF.</p>

      <div class="mt-6 flex flex-wrap items-center justify-center gap-3">
        <!-- Descargar -->
        <a href={CV_URL} download
           class="inline-flex items-center gap-2 rounded-lg bg-zinc-900 text-white px-4 py-2 hover:bg-zinc-800 transition">
          ‚¨áÔ∏è Descargar
        </a>
        <!-- Abrir en nueva pesta√±a -->
        <a href={CV_URL} target="_blank" rel="noopener"
           class="inline-flex items-center gap-2 rounded-lg ring-1 ring-zinc-300 px-4 py-2 hover:bg-zinc-50 transition">
          üîó Abrir en pesta√±a nueva
        </a>
        <!-- Imprimir -->
        <button type="button"
           class="inline-flex items-center gap-2 rounded-lg ring-1 ring-zinc-300 px-4 py-2 hover:bg-zinc-50 transition"
           onclick="window.print()">
          üñ®Ô∏è Imprimir
        </button>
      </div>
    </section>

    <!-- Visor embebido -->
   <section class="mx-auto max-w-6xl px-6 pb-12">
  <div class="rounded-xl ring-1 ring-zinc-200 overflow-hidden bg-white">
    <!-- 1¬™ opci√≥n: <embed> nativo -->
    <embed id="cv-embed"
           src="/cv.pdf#view=FitH"
           type="application/pdf"
           class="w-full h-[75vh]"
           />

    <!-- Fallback visible si falla todo -->
    <div id="cv-fallback" class="hidden p-6 text-center text-zinc-600">
      No se pudo mostrar el PDF embebido.
      <a href="/cv.pdf" target="_blank" rel="noopener" class="underline">√Åbrelo aqu√≠</a>
      o usa el bot√≥n Descargar.
    </div>
  </div>

  <script is:inline>
    // Si el navegador no soporta <embed> con PDF, cambiamos a Google Viewer.
    (function () {
      const origin = location.origin || (location.protocol + '//' + location.host);
      const fileUrl = origin + '/cv.pdf';
      const embed = document.getElementById('cv-embed');
      const fallback = document.getElementById('cv-fallback');

      // Algunos navegadores no lanzan error; probamos a cargar y, si no hay documento, usamos viewer externo.
      let switched = false;
      function useGoogleViewer() {
        if (switched) return;
        switched = true;
        // Google Docs Viewer (s√≥lo si el PDF es accesible p√∫blicamente)
        embed.setAttribute('src', 'https://docs.google.com/gview?embedded=1&url=' + encodeURIComponent(fileUrl));
      }

      // Si en 1.2s no se ha renderizado nada, forzamos viewer alternativo
      setTimeout(() => {
        try {
          // En la mayor√≠a de casos con soporte, el <embed> ya muestra contenido.
          // Si el contenedor sigue vac√≠o (algunos navegadores), probamos el viewer externo.
          const hasSize = embed && embed.clientHeight > 0 && embed.clientWidth > 0;
          if (!hasSize) useGoogleViewer();
        } catch (e) {
          useGoogleViewer();
        }
      }, 1200);

      // Como √∫ltimo recurso, mostramos fallback textual
      // (por si Google Viewer tambi√©n estuviera bloqueado)
      setTimeout(() => {
        // Si no hay ninguna navegaci√≥n visible (altura ~0), mostramos fallback
        const height = embed?.clientHeight || 0;
        const iframeMode = embed?.tagName === 'IFRAME'; // por si el navegador lo transforma
        if ((!height || height < 50) && !iframeMode) {
          embed.classList.add('hidden');
          fallback?.classList.remove('hidden');
        }
      }, 2500);
    })();
  </script>
</section>


  </main>

  <SiteFooter />
</Base>
